<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:composite="http://java.sun.com/jsf/composite">

<composite:interface>
	<composite:attribute name="picPaths" required="true"/>
 	<composite:attribute name="showImage" type="java.lang.Boolean" default="true" />
</composite:interface>

<composite:implementation>
	<script id="searchCallback" type="text/javascript" src=""></script>
	<script type="text/javascript">
	//<![CDATA[
    var picPaths = '#{cc.attrs.picPaths}'.split(',');
    var imageCount = 0;

    function showImage() {
		if (picPaths.length < 1) {
			jQuery('#nextImage').hide();
			jQuery('#gImageContent').html('#{generalMsg.imageNA}');
		} else {
			var contentDiv = document.getElementById('gImageContent');
			contentDiv.innerHTML = '';
			var imgContainer = document.createElement('div');
			var newImg = document.createElement('img');
			newImg.src = picPaths[imageCount];
			newImg.style.width="100%";
            newImg.style.height="auto";
			imgContainer.appendChild(newImg);
			contentDiv.appendChild(imgContainer);

			if (picPaths.length == 1) {jQuery('#nextImage').hide();}
			else {jQuery('#nextImage').show();}
		}
	}

	function resetImage(newPicPaths) {
		picPaths = newPicPaths;
		imageCount = 0;
		if (#{cc.attrs.showImage} && #{userSession.showGoogleImage}) {
			showImage();
		}
	}

	function changeImg() {
		imageCount = imageCount + 1;
		if (imageCount >= picPaths.length) imageCount = 0;

		var contentDiv = document.getElementById('gImageContent');
		contentDiv.innerHTML = '';
		var imgContainer = document.createElement('div');
		//var newImg = document.createElement('img');
		//newImg.src = picPaths[imageCount];
		//newImg.style.width="100%";
        //newImg.style.height="auto";
		//imgContainer.appendChild(newImg);
		jQuery('<img src="'+ picPaths[imageCount] +'">').load(function() {
			jQuery(this).width('100%').height('auto').appendTo(imgContainer);
		});
		contentDiv.appendChild(imgContainer);
	}
	//]]>
    </script>

<a4j:outputPanel id="googleImagePanel">
<h:panelGroup rendered="#{cc.attrs.showImage and userSession.showGoogleImage}">
    <table style="width: 250px; height: 230px; border:2px solid #FF8620; margin-left: 30px;">
    	<tr>
    		<td colspan="2" valign="middle" align="center" style="width: 100%; height: 200;"><div id="gImageContent" style="width:100%; height:auto;">Loading...</div></td>
    	</tr>
    	<tr>
    		<td align="center" valign="top" style="height: 20px;"><div style="cursor: pointer;" id="nextImage" onclick="changeImg()"><h:graphicImage value="/images/icon/silk/picture_go.png" />#{generalMsg.nextImage}</div></td>
    		<td align="center" valign="top" style="height: 20px;">
    			<h:form>
    				<h:commandLink render="googleImagePanel" id="stopShowImage" action="#{userSession.stopShowGoogleImage}"><h:graphicImage value="/images/icon/silk/cancel.png" style="border: 0px;" />#{generalMsg.stopShow}</h:commandLink>
    			</h:form>
    		</td>
    	</tr>
    </table>
    <script language="Javascript" type="text/javascript">
	//<![CDATA[
		showImage();
	//]]>
	</script>
</h:panelGroup>
<h:panelGroup rendered="#{!cc.attrs.showImage or !userSession.showGoogleImage}">
	<table style="width: 300px; height: 250px; border:5px solid #FF8620;">
    	<tr>
    		<td valign="middle" align="center"><div id="gImageContent" style="font-size: 20px; font-weight: bold; color: #FF8620;">#{generalMsg.doNotShowImage}</div></td>
    	</tr>
    	<tr>
    		<td align="center" style="height: 20px;"><h:form><h:commandLink render="googleImagePanel" id="resumeShowImage" action="#{userSession.resumeShowGoogleImage}"><h:graphicImage value="/images/icon/silk/picture.png" style="border: 0px;" />#{generalMsg.resumeShow}</h:commandLink></h:form></td>
    	</tr>
    </table>
</h:panelGroup>
</a4j:outputPanel>
</composite:implementation>
</html>